<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biology arXiv Updates daily</title>

    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="x-icon" href="/img/favicon.ico">

    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/img/android-chrome-512x512.png">

    <link rel="manifest" href="/img/site.webmanifest">

    <meta name="theme-color" content="#ffffff">
    
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <h1>Biology arXiv Updates daily</h1>

    <p>Welcome to the Biology arXiv pages! This site daily crawls arXiv (primarily Biology), <br > and generates summaries for each paper, helping you stay updated on the latest information in Biology and Computer Science.</p>
    <p>Please note that the content may be delayed.</p>
    <p>Provide feedback on <a href="https://github.com/yukari502/yukari502.github.io">GitHub</a>.</p>

    <div id="navigation-container">
        <span id="nav-path"></span>
    </div>

    <div id="updates-container">
        <div class="loading">少女祈禱中.....</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const updatesContainer = document.getElementById('updates-container');
            const navPathContainer = document.getElementById('nav-path');
            const baseUrl = window.location.origin;

            function renderPath(pathSegments) {
                navPathContainer.innerHTML = ''; // Clear previous navigation
                let pathHtml = '';
                let currentPath = baseUrl;

                pathSegments.forEach((segment, index) => {
                    currentPath += `/${segment}`;
                    if (index < pathSegments.length - 1) {
                        pathHtml += `<a href="${currentPath}">${segment}</a> / `;
                    } else {
                        pathHtml += `<span>${segment}</span>`;
                    }
                });
                navPathContainer.innerHTML = pathHtml;
            }

            async function loadContent() {
                try {
                    const path = window.location.pathname;
                    // If the path is just /, load the year list
                    if (path === '/' || path.endsWith('/index.html')) {
                        const response = await fetch('data/index.json');
                        if (!response.ok) {
                            throw new Error('无法获取更新文件列表,請刷新重试。');
                        }
                        const data = await response.json();
                        renderYearList(data.filesByYear);
                        renderPath(['yukari502.github.io']);
                        return;
                    }

                    // Otherwise, load the specific content
                    const pathSegments = path.split('/').filter(Boolean); // Split path and remove empty strings
                    const [year, month, file] = pathSegments;

                    if (file && file.endsWith('.md')) {
                        // Load and render a specific Markdown file
                        const mdPath = `data/${pathSegments.join('/')}`;
                        const response = await fetch(mdPath);
                        if (!response.ok) {
                            throw new Error('无法加载内容。');
                        }
                        const markdown = await response.text();
                        updatesContainer.innerHTML = marked.parse(markdown);
                        renderPath(pathSegments);
                    } else if (month) {
                        // Load and render month view
                        const response = await fetch(`data/${year}/index.json`);
                        if (!response.ok) {
                            throw new Error('无法获取月份列表。');
                        }
                        const data = await response.json();
                        renderMonthView(data.filesByMonth, month);
                        renderPath([year, month]);
                    } else if (year) {
                        // Load and render year view
                        const response = await fetch(`data/index.json`);
                        if (!response.ok) {
                            throw new Error('无法获取年份列表。');
                        }
                        const data = await data.json();
                        renderYearView(data.filesByYear, year);
                        renderPath([year]);
                    }
                } catch (error) {
                    console.error('Error loading content:', error);
                    updatesContainer.innerHTML = `<div class="error">加载内容失败: ${error.message}</div>`;
                }
            }

            function renderYearList(filesByYear) {
                let html = '<h2>Years</h2><ul>';
                const years = Object.keys(filesByYear).sort((a, b) => b - a);
                years.forEach(year => {
                    html += `<li><a href="${baseUrl}/${year}">${year}</a></li>`;
                });
                html += '</ul>';
                updatesContainer.innerHTML = html;
            }

            function renderYearView(filesByYear, year) {
                const files = filesByYear[year];
                if (!files) {
                    updatesContainer.innerHTML = `<div class="error">No updates found for ${year}.</div>`;
                    return;
                }
                const filesByMonth = files.reduce((acc, file) => {
                    const month = new Date(file.date).getMonth();
                    const monthName = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][month];
                    if (!acc[monthName]) {
                        acc[monthName] = [];
                    }
                    acc[monthName].push(file);
                    return acc;
                }, {});

                let html = `<h2>${year}</h2><ul>`;
                const sortedMonths = Object.keys(filesByMonth).sort((a, b) => {
                    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                    return months.indexOf(b) - months.indexOf(a);
                });
                sortedMonths.forEach(month => {
                    html += `<li><a href="${baseUrl}/${year}/${month}">${month}</a></li>`;
                });
                html += '</ul>';
                updatesContainer.innerHTML = html;
            }

            function renderMonthView(filesByMonth, month) {
                const files = filesByMonth[month];
                if (!files) {
                    updatesContainer.innerHTML = `<div class="error">No updates found for ${month}.</div>`;
                    return;
                }
                let html = `<h2>${month}</h2><ul>`;
                files.sort((a, b) => new Date(b.date) - new Date(a.date));
                files.forEach(file => {
                    const dateStr = file.date;
                    html += `<li><a href="${baseUrl}/${file.path}">${dateStr}</a></li>`;
                });
                html += '</ul>';
                updatesContainer.innerHTML = html;
            }

            // Listen for changes in the URL hash or state to trigger content loading
            window.addEventListener('popstate', loadContent);
            
            // Initial load
            loadContent();
        });
    </script>
</body>
</html>