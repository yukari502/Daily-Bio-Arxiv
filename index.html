<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biology arXiv Updates daily</title>

    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="x-icon" href="/img/favicon.ico">

    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/img/android-chrome-512x512.png">

    <link rel="manifest" href="/img/site.webmanifest">

    <meta name="theme-color" content="#ffffff">
    
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <h1>Biology arXiv Updates daily</h1>

    <p>Welcome to the Biology arXiv pages! This site daily crawls arXiv (primarily Biology), <br > and generates summaries for each paper, helping you stay updated on the latest information in Biology and Computer Science.</p>
    <p>Please note that the content may be delayed.</p>
    <p>Provide feedback on <a href="https://github.com/yukari502/yukari502.github.io">GitHub</a>.</p>

    <div id="updates-container">
        <div class="loading">少女祈禱中.....</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const updatesContainer = document.getElementById('updates-container');
            let allData = null; // 存储所有从JSON加载的数据
            let currentState = {}; // 跟踪当前的视图状态 {level, year, month, path, dateStr}

            const monthNames = [
                "January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];

            // 1. 从静态JSON文件获取更新列表
            async function fetchUpdates() {
                try {
                    const response = await fetch('data/index.json');
                    if (!response.ok) {
                        throw new Error('无法获取更新文件列表, 請刷新重试。');
                    }
                    allData = await response.json();

                    if (!allData.filesByYear || Object.keys(allData.filesByYear).length === 0) {
                        updatesContainer.innerHTML = '<div class="error">暂无更新内容</div>';
                        return;
                    }
                    
                    // 初始化应用，显示年份列表
                    navigateTo({ level: 'years' });
                } catch (error) {
                    console.error('Error fetching updates:', error);
                    updatesContainer.innerHTML = `<div class="error">加载更新内容失败: ${error.message}</div>`;
                }
            }
            
            // 2. 导航和状态管理
            function navigateTo(state) {
                currentState = state;
                renderCurrentView();
            }

            // 3. 核心渲染函数：根据当前状态决定显示什么
            function renderCurrentView() {
                const { level } = currentState;

                if (level === 'content') {
                    renderContentView();
                } else {
                    renderListView();
                }
                attachEventListeners();
            }

            // 4. 渲染列表视图（年、月、日）
            function renderListView() {
                const { level, year, month } = currentState;
                let listHtml = '';
                
                if (level === 'years') {
                    listHtml = renderYearList(allData.filesByYear);
                } else if (level === 'months') {
                    listHtml = renderMonthList(allData.filesByYear, year);
                } else if (level === 'days') {
                    listHtml = renderDayList(allData.filesByYear, year, month);
                }
                // Add a class to the container based on the current view level
                const containerClass = `item-list-container ${level}-view`;
                updatesContainer.innerHTML = `
                    ${renderBreadcrumbs()}
                    <div class="${containerClass}">${listHtml}</div>
                `;
            }
            
            // 5. 渲染最终的内容视图
            async function renderContentView() {
                updatesContainer.innerHTML = `
                    ${renderBreadcrumbs()}
                    <div id="content-display">
                        <div class="loading">少女祈禱中.....</div>
                    </div>
                `;

                try {
                    const response = await fetch(currentState.path);
                    if (!response.ok) throw new Error('无法加载内容');
                    const markdown = await response.text();
                    const contentDiv = document.getElementById('content-display');
                    if (contentDiv) {
                        contentDiv.innerHTML = `<div class="markdown-content">${marked.parse(markdown)}</div>`;
                    }
                } catch (error) {
                    const contentDiv = document.getElementById('content-display');
                    if(contentDiv) {
                       contentDiv.innerHTML = `<div class="error">加载内容失败: ${error.message}</div>`;
                    }
                }
            }

            // 6. 各级别列表的HTML生成器
            function renderBreadcrumbs() {
                const { level, year, month, dateStr } = currentState;
                let crumbs = `<a href="#" class="breadcrumb-item" data-level="years">Home</a>`;

                if (year) {
                    crumbs += `<span> / </span><a href="#" class="breadcrumb-item" data-level="months" data-year="${year}">${year}</a>`;
                }
                if (month !== undefined && month !== null) {
                    crumbs += `<span> / </span><a href="#" class="breadcrumb-item" data-level="days" data-year="${year}" data-month="${month}">${monthNames[month]}</a>`;
                }
                if (level === 'content' && dateStr) {
                    crumbs += `<span> / </span><span class="breadcrumb-current">${dateStr}</span>`; // 当前页面，不可点击
                }
                return `<nav class="breadcrumb-nav">${crumbs}</nav>`;
            }

            function renderYearList(filesByYear) {
                const years = Object.keys(filesByYear).sort((a, b) => b - a);
                return years.map(year => `
                    <div class="list-item year-item" data-level="months" data-year="${year}">
                        ${year}
                    </div>
                `).join('');
            }

            function renderMonthList(filesByYear, year) {
                const files = filesByYear[year];
                const months = [...new Set(files.map(file => new Date(file.date).getMonth()))]
                    .sort((a, b) => b - a);
                return months.map(monthIndex => `
                    <div class="list-item month-item" data-level="days" data-year="${year}" data-month="${monthIndex}">
                        ${monthNames[monthIndex]}
                    </div>
                `).join('');
            }

            function renderDayList(filesByYear, year, month) {
                const filesForMonth = filesByYear[year]
                    .filter(file => new Date(file.date).getMonth() == month)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                return filesForMonth.map(file => `
                    <div class="list-item day-item" data-path="${file.path}" data-date-str="${file.date}">
                        ${file.date}
                    </div>
                `).join('');
            }

            // 7. 事件监听器
            function attachEventListeners() {
                updatesContainer.addEventListener('click', function(e) {
                    const target = e.target.closest('.list-item, .breadcrumb-item');
                    if (!target) return;
                    e.preventDefault();

                    if (target.classList.contains('day-item')) { // Changed from file-item to be more specific
                        const { path, dateStr } = target.dataset;
                        const date = new Date(dateStr);
                        navigateTo({
                            level: 'content',
                            year: date.getFullYear(),
                            month: date.getMonth(),
                            path: path,
                            dateStr: dateStr
                        });
                    } else {
                        const { level, year, month } = target.dataset;
                        navigateTo({
                            level: level,
                            year: year,
                            month: month
                        });
                    }
                }, { once: true }); // 使用once确保每次渲染后只绑定一次事件
            }

            // 初始化
            fetchUpdates();
        });
    </script>
</body>
</html>