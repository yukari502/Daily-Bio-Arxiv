<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Biology arXiv Updates</title>

    <!-- Favicon and device icons -->
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="x-icon" href="img/favicon.ico">

    <link rel="apple-touch-icon" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="img/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="img/android-chrome-512x512.png">

    <link rel="manifest" href="img/site.webmanifest">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <button id="theme-toggle" aria-label="Toggle dark mode">
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
            <path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/>
        </svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
            <path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.662 17.854 17.316 22 12.001 22 6.477 22 2 17.523 2 12c0-5.315 4.146-9.661 9.38-9.981z"/>
        </svg>
    </button>
    
    <h1>Daily Biology arXiv Updates</h1>

    <p>Welcome to the Biology arXiv pages! This site crawls arXiv daily (primarily Biology), <br > and generates summaries for each paper, helping you stay updated on the latest research in Biology and Computer Science.</p>
    <p>Please note that the content may be delayed.</p>
    <p>Provide feedback on <a href="https://github.com/yukari502/Daily-Bio-Arxiv" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>

    <div id="quick-links-container"></div>
    
    <h2 class="history-title">Browse Full Archive</h2>

    <div id="updates-container">
        <div class="loading">少女祈禱中.....</div>
    </div>

    <hr class="footer-divider">

    <footer class="site-footer">
    <p>
        <a href="https://github.com/yukari502/Daily-Bio-Arxiv" target="_blank" rel="noopener noreferrer">Source Code on GitHub</a>
    </p>
        <p>
            This project is licensed under the 
            <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener noreferrer">GPL 3.0 License</a>.
        </p>
        <p class="disclaimer">
            <strong>Disclaimer:</strong> This is an automated, unofficial service. Summaries are generated by AI and may contain inaccuracies. 
            Always refer to the original papers on arXiv.org for authoritative information. This site is not affiliated with arXiv.
        </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Theme toggle functionality
        function initTheme() {
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
            const storedTheme = localStorage.getItem('theme');
            
            if (storedTheme) {
                document.documentElement.setAttribute('data-theme', storedTheme);
            } else if (prefersDarkScheme.matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }

            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });

            prefersDarkScheme.addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            const updatesContainer = document.getElementById('updates-container');
            const quickLinksContainer = document.getElementById('quick-links-container');
            
            let mainIndex = null; 
            const yearDataCache = {}; 
            let currentState = {};

            const monthNames = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ];

            async function fetchYearData(year) {
                if (yearDataCache[year]) {
                    return yearDataCache[year];
                }
                const response = await fetch(`data/index_${year}.json`);
                if (!response.ok) throw new Error(`Failed to load index for year ${year}.`);
                const data = await response.json();
                yearDataCache[year] = data;
                return data;
            }

            async function fetchUpdates() {
                try {
                    const response = await fetch('data/index.json');
                    if (!response.ok) throw new Error('Failed to fetch main index. Please refresh.');
                    mainIndex = await response.json();

                    if (!mainIndex.years || mainIndex.years.length === 0) {
                        updatesContainer.innerHTML = '<div class="error">No updates available.</div>';
                        return;
                    }
                    
                    const latestYear = mainIndex.years[0];
                    const latestYearData = await fetchYearData(latestYear);
                    createLatestArticleLink(latestYearData.files[0]);

                    navigateTo({ level: 'years' });
                } catch (error) {
                    console.error('Error during initial fetch:', error);
                    updatesContainer.innerHTML = `<div class="error">${error.message}</div>`;
                }
            }

            function createLatestArticleLink(latestFile) {
                if (!latestFile) return;
                const linkCard = document.createElement('a');
                linkCard.href = '#';
                linkCard.className = 'quick-link-card';
                linkCard.innerHTML = 'Bio arXiv Today <span class="arrow">→</span>';
                linkCard.dataset.path = latestFile.path;
                linkCard.dataset.dateStr = latestFile.date;
                quickLinksContainer.appendChild(linkCard);
            }
            
            function navigateTo(state) {
                currentState = state;
                renderCurrentView();
            }

            function renderCurrentView() {
                if (currentState.level === 'content') renderContentView();
                else renderListView();
            }

            function renderListView() {
                const { level, year, month } = currentState;
                let listHtml = '';
                
                if (level === 'years') listHtml = renderYearList();
                else if (level === 'months') listHtml = renderMonthList(year);
                else if (level === 'days') listHtml = renderDayList(year, month);

                const containerClass = `item-list-container ${level}-view`;
                updatesContainer.innerHTML = `${renderBreadcrumbs()}<div class="${containerClass}">${listHtml}</div>`;
            }
            
            async function renderContentView() {
                updatesContainer.innerHTML = `${renderBreadcrumbs()}<div id="content-display"><div class="loading">少女祈禱中.....</div></div>`;
                try {
                    const response = await fetch(currentState.path);
                    if (!response.ok) throw new Error('Failed to load content.');
                    const markdown = await response.text();
                    const contentDiv = document.getElementById('content-display');
                    if (contentDiv) contentDiv.innerHTML = `<div class="markdown-content">${marked.parse(markdown)}</div>`;
                } catch (error) {
                    const contentDiv = document.getElementById('content-display');
                    if(contentDiv) contentDiv.innerHTML = `<div class="error">Failed to load content: ${error.message}</div>`;
                }
            }

            function renderBreadcrumbs() {
                const { level, year, month, dateStr } = currentState;
                let crumbs = `<a href="#" class="breadcrumb-item" data-level="years">Home</a>`;
                if (year) crumbs += `<span> / </span><a href="#" class="breadcrumb-item" data-level="months" data-year="${year}">${year}</a>`;
                if (month !== undefined && month !== null) crumbs += `<span> / </span><a href="#" class="breadcrumb-item" data-level="days" data-year="${year}" data-month="${month}">${monthNames[month]}</a>`;
                if (level === 'content' && dateStr) crumbs += `<span> / </span><span class="breadcrumb-current">${dateStr}</span>`;
                return `<nav class="breadcrumb-nav">${crumbs}</nav>`;
            }

            function renderYearList() {
                return mainIndex.years.map(year => `<div class="list-item year-item" data-level="months" data-year="${year}">${year} <span class="arrow">→</span></div>`).join('');
            }

            function renderMonthList(year) {
                const yearData = yearDataCache[year];
                if (!yearData) return `<div class="error">Data for year ${year} not loaded.</div>`;
                const months = [...new Set(yearData.files.map(file => new Date(file.date).getMonth()))].sort((a, b) => b - a);
                return months.map(monthIndex => `<div class="list-item month-item" data-level="days" data-year="${year}" data-month="${monthIndex}">${monthNames[monthIndex]} <span class="arrow">→</span></div>`).join('');
            }

            function renderDayList(year, month) {
                const yearData = yearDataCache[year];
                if (!yearData) return `<div class="error">Data for year ${year} not loaded.</div>`;
                const filesForMonth = yearData.files.filter(file => new Date(file.date).getMonth() == month);
                return filesForMonth.map(file => `<div class="list-item day-item" data-path="${file.path}" data-date-str="${file.date}">${file.date} <span class="arrow">→</span></div>`).join('');
            }

            function attachEventListeners() {
                document.body.addEventListener('click', async function(e) {
                    const target = e.target.closest('.list-item, .breadcrumb-item, .quick-link-card');
                    if (!target) return;
                    e.preventDefault();

                    const { path, dateStr, level, year, month } = target.dataset;

                    if (target.classList.contains('quick-link-card') || target.classList.contains('day-item')) {
                        const date = new Date(dateStr);
                        navigateTo({ level: 'content', year: date.getFullYear(), month: date.getMonth(), path: path, dateStr: dateStr });
                    } else {
                        if (level === 'months' || (level === 'days' && !yearDataCache[year])) {
                            updatesContainer.innerHTML = `<div class="loading">少女祈禱中.....</div>`;
                            await fetchYearData(year);
                        }
                        navigateTo({ level, year, month });
                    }
                });
            }

            // Initialize
            fetchUpdates();
            attachEventListeners();
        });
    </script>
</body>
</html>
