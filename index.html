<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Biology arXiv Updates</title>
    <!-- ... a többi head tartalom ... -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ... a meglévő body tartalom (h1, p, footer, stb.) ... -->
    <h1>Daily Biology arXiv Updates</h1>
    <p>Welcome to the Biology arXiv pages! This site crawls arXiv daily (primarily Biology), <br > and generates summaries for each paper, helping you stay updated on the latest research in Biology and Computer Science.</p>
    <p>Please note that the content may be delayed.</p>
    <p>Provide feedback on <a href="https://github.com/yukari502/yukari502.github.io" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>
    <div id="quick-links-container"></div>
    <h2 class="history-title">Browse Full Archive</h2>
    <div id="updates-container">
        <div class="loading">少女祈禱中.....</div>
    </div>
    <hr class="footer-divider">
    <footer class="site-footer">
        <p><a href="https://github.com/yukari502/yukari502.github.io" target="_blank" rel="noopener noreferrer">Source Code on GitHub</a></p>
        <p>This project is licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener noreferrer">GPL 3.0 License</a>.</p>
        <p class="disclaimer"><strong>Disclaimer:</strong> This is an automated, unofficial service. Summaries are generated by AI and may contain inaccuracies. Always refer to the original papers on arXiv.org for authoritative information. This site is not affiliated with arXiv.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const updatesContainer = document.getElementById('updates-container');
            const quickLinksContainer = document.getElementById('quick-links-container');
            
            let mainIndex = null; 
            const yearDataCache = {}; // Cache for loaded yearly data
            let currentState = {};

            const monthNames = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ];

            // --- NEW LOGIC: Helper to fetch and cache year data ---
            async function fetchYearData(year) {
                if (yearDataCache[year]) {
                    return yearDataCache[year]; // Return from cache
                }
                const response = await fetch(`data/index_${year}.json`);
                if (!response.ok) throw new Error(`Failed to load index for year ${year}.`);
                const data = await response.json();
                yearDataCache[year] = data; // Store in cache
                return data;
            }

            async function fetchUpdates() {
                try {
                    const response = await fetch('data/index.json');
                    if (!response.ok) throw new Error('Failed to fetch main index. Please refresh.');
                    mainIndex = await response.json();

                    if (!mainIndex.years || mainIndex.years.length === 0) {
                        updatesContainer.innerHTML = '<div class="error">No updates available.</div>';
                        return;
                    }
                    
                    // Pre-load the latest year's data for the "Today" button
                    const latestYear = mainIndex.years[0];
                    const latestYearData = await fetchYearData(latestYear);
                    createLatestArticleLink(latestYearData.files[0]); // Assumes files are pre-sorted

                    navigateTo({ level: 'years' });
                } catch (error) {
                    console.error('Error during initial fetch:', error);
                    updatesContainer.innerHTML = `<div class="error">${error.message}</div>`;
                }
            }

            function createLatestArticleLink(latestFile) {
                if (!latestFile) return;
                const linkCard = document.createElement('a');
                linkCard.href = '#';
                linkCard.className = 'quick-link-card';
                linkCard.innerHTML = 'Bio arXiv Today <span class="arrow">→</span>';
                linkCard.dataset.path = latestFile.path;
                linkCard.dataset.dateStr = latestFile.date;
                quickLinksContainer.appendChild(linkCard);
            }
            
            function navigateTo(state) {
                currentState = state;
                renderCurrentView();
            }

            function renderCurrentView() {
                if (currentState.level === 'content') renderContentView();
                else renderListView();
            }

            function renderListView() {
                const { level, year, month } = currentState;
                let listHtml = '';
                
                if (level === 'years') listHtml = renderYearList();
                else if (level === 'months') listHtml = renderMonthList(year);
                else if (level === 'days') listHtml = renderDayList(year, month);

                const containerClass = `item-list-container ${level}-view`;
                updatesContainer.innerHTML = `${renderBreadcrumbs()}<div class="${containerClass}">${listHtml}</div>`;
            }
            
            async function renderContentView() {
                updatesContainer.innerHTML = `${renderBreadcrumbs()}<div id="content-display"><div class="loading">少女祈禱中.....</div></div>`;
                try {
                    const response = await fetch(currentState.path);
                    if (!response.ok) throw new Error('Failed to load content.');
                    const markdown = await response.text();
                    const contentDiv = document.getElementById('content-display');
                    if (contentDiv) contentDiv.innerHTML = `<div class="markdown-content">${marked.parse(markdown)}</div>`;
                } catch (error) {
                    const contentDiv = document.getElementById('content-display');
                    if(contentDiv) contentDiv.innerHTML = `<div class="error">Failed to load content: ${error.message}</div>`;
                }
            }

            function renderBreadcrumbs() {
                const { level, year, month, dateStr } = currentState;
                let crumbs = `<a href="#" class="breadcrumb-item" data-level="years">Home</a>`;
                if (year) crumbs += `<span> / </span><a href="#" class="breadcrumb-item" data-level="months" data-year="${year}">${year}</a>`;
                if (month !== undefined && month !== null) crumbs += `<span> / </span><a href="#" class="breadcrumb-item" data-level="days" data-year="${year}" data-month="${month}">${monthNames[month]}</a>`;
                if (level === 'content' && dateStr) crumbs += `<span> / </span><span class="breadcrumb-current">${dateStr}</span>`;
                return `<nav class="breadcrumb-nav">${crumbs}</nav>`;
            }

            function renderYearList() {
                return mainIndex.years.map(year => `<div class="list-item year-item" data-level="months" data-year="${year}">${year} <span class="arrow">→</span></div>`).join('');
            }

            function renderMonthList(year) {
                const yearData = yearDataCache[year];
                if (!yearData) return `<div class="error">Data for year ${year} not loaded.</div>`;
                const months = [...new Set(yearData.files.map(file => new Date(file.date).getMonth()))].sort((a, b) => b - a);
                return months.map(monthIndex => `<div class="list-item month-item" data-level="days" data-year="${year}" data-month="${monthIndex}">${monthNames[monthIndex]} <span class="arrow">→</span></div>`).join('');
            }

            function renderDayList(year, month) {
                const yearData = yearDataCache[year];
                if (!yearData) return `<div class="error">Data for year ${year} not loaded.</div>`;
                const filesForMonth = yearData.files.filter(file => new Date(file.date).getMonth() == month);
                return filesForMonth.map(file => `<div class="list-item day-item" data-path="${file.path}" data-date-str="${file.date}">${file.date} <span class="arrow">→</span></div>`).join('');
            }

            function attachEventListeners() {
                document.body.addEventListener('click', async function(e) { // Make listener async
                    const target = e.target.closest('.list-item, .breadcrumb-item, .quick-link-card');
                    if (!target) return;
                    e.preventDefault();

                    const { path, dateStr, level, year, month } = target.dataset;

                    if (target.classList.contains('quick-link-card') || target.classList.contains('day-item')) {
                        const date = new Date(dateStr);
                        navigateTo({ level: 'content', year: date.getFullYear(), month: date.getMonth(), path: path, dateStr: dateStr });
                    } else {
                        // --- NEW LOGIC: Load year data on demand when a year is clicked ---
                        if (level === 'months' || (level === 'days' && !yearDataCache[year])) {
                            updatesContainer.innerHTML = `<div class="loading">少女祈禱中.....</div>`; // Show loading indicator
                            await fetchYearData(year);
                        }
                        navigateTo({ level, year, month });
                    }
                });
            }

            // Initialize
            fetchUpdates();
            attachEventListeners();
        });
    </script>
</body>
</html>